<% if @order.errors.any? %>
  <div id="error_explanation">
    <h2><%= pluralize(@order.errors.count, "error") %> prohibited this order from being saved:</h2>
    <ul>
    <% @order.errors.full_messages.each do |message| %>
      <li><%= message %></li>
    <% end %>
    </ul>
  </div>
<% end %>


<p class="text-lg text-center ">Order status: <%= @order.status.capitalize %>
<p class="flex justify-center mb-4">
<% if @order.pending? %>
<%= image_tag('hourglass.png', size: '40x40', alt: "Pending") %>
<% elsif @order.in_progress? %>
<%= image_tag('list.png', size: '40x40', alt: "In Progress") %>
<% else %>
<%= image_tag('ok.png', size: '40x40', alt: "Completed") %>
<% end %>
<p>

  <p class="text-sm">Scaffolder: <%= @order.user.name %> <%= @order.user.email %></p>
  <p class="text-sm">Building Site: <strong><%= @order.building_site %></strong></p>
  <% if @order.building_site_info.present? %>
  <p class="text-sm">Site info: <%= @order.building_site_info %></p>
  <% end %>
</div>

<h2 class="mt-10 ml-1 mr-1">Ordered Parts:</h2>
<% total_weight = 0 %>
<%= form_with(model: @order, url: warehouse_storage_path(@order), method: :patch) do |form| %>
  <% @order.order_lists.includes(:part).sort_by { |ol| ol.part ? ol.part.name : '' }.each_with_index do |order_list, index| %>
    <%= form.fields_for :order_lists, order_list do |order_list_form| %>
      <div class="m-1  border-b-2 flex inline">
        <p class="text-sm mb-2 "><%= index + 1 %>. <%= order_list.description %> -- </p>
<p class="text-sm text-indigo-800 "><strong><%= order_list.quantity %></strong>/</p>
<p class=" text-green-800 w-20 text-sm pt-1">
<% if order_list.delivery_quantity.present? %>
<%= order_list.delivery_quantity %>
<% else %>
???
<% end %>
 stk</p>

        <% total_weight += order_list.quantity * order_list.weight %>
      </div>
    <% end %>
  
<% end %>
<% if @order.info.present? %>
<p class="mt-10 m-1 text-sm"><strong>Additional Info/Parts:</strong> <%= simple_format(@order.info,  class: "text-sm m-1" )%></p>
  <% end %>
   <% if @order.storage_info.present? %>
    <div class="mt-4 m-1">
      <p><strong><%= form.label :storage_info, "Storage Parts/Delivery Info:", class: " mt-2 " %></strong></p>
      <p><%= simple_format(@order.storage_info) %></p>
    </div>
<% end %>

<% if @order.new_delivery_date.present? %>

  
  <div class="mt-4 justify-center text-center">
    <p class="text-sm mt-4 m-1">Delivery Date wanted: <%= @order.delivery_date.strftime("%d-%m-%Y") %></p>
    <p class="text-lg"> <strong> New delivery date: <%= @order.new_delivery_date %> </strong></p>
  </div>
<% else %>
<div class="mt-4 justify-center text-center">
    <p class="text-lg mt-4">Delivery Date: <%= @order.delivery_date.strftime("%d-%m-%Y") %></p>
    
  </div>
<% end %>
<% if @order.car_number.present? %>
  <div class="flex justify-center mt-4">
    
    Car number: <%= @order.car_number%>
  </div>
  <% end %>
<% end %>
<p class="text-center m-4"><strong>Total Weight:</strong> <%= total_weight %>kg</p>



